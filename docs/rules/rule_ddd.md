# DDD 階層化設計ガイド

このドキュメントは、本プロジェクトにおけるドメイン駆動設計（DDD）の階層化アーキテクチャのルールと責務を定義するものです。
すべての機能開発は、このガイドに従って実装してください。

## 1. 基本思想

我々のアーキテクチャは、関心事の分離を徹底するための4つの主要な層（レイヤー）で構成されます。
中心にビジネスの核である **`domain`** を置き、その周りを **`usecase`**、**`interface`**、**`infrastructure`** が囲む、クリーンアーキテクチャの思想に基づいています。



**依存関係:**

```
[ interface ] ----> [ usecase ] ----> [ domain ]
      ^                                    ^
      |                                    |
[ infrastructure ] ------------------------+
```

## 2. 各層の役割と責務

### `domain` 層

- **役割:** ビジネスのルールと知識の核心。アプリケーションが「何を」解決するのかを表現する層。
- **責務:**
    - **エンティティ (Entity):** 状態を持ち、一意なIDで識別されるビジネスオブジェクト。（例: `Task`, `User`）
    - **値オブジェクト (Value Object):** 値そのものを表現し、不変であるオブジェクト。（例: `TaskName`, `EmailAddress`）
    - **リポジトリ (Repository) のインターフェース:** データ永続化の**I/Fのみ**を定義します。**実装は `infrastructure` 層**に任せます。
- **ルール:**
    - **フレームワーク非依存:** Spring, JPA, Webフレームワークなど、いかなる外部技術のクラスも**使用してはいけません**。
    - **純粋なビジネスロジック:** この層には、ビジネス上の関心事のみを記述します。

### `usecase` 層 (アプリケーション層)

- **役割:** ユーザーがアプリケーションでしたいこと（ユースケース）を実現するための具体的な処理フローを記述する層。
- **責務:**
    - **ユースケースの実装:** `domain` 層のエンティティやリポジトリを操作し、一連のビジネスフローを組み立てます。
    - **トランザクション管理:** データベーストランザクションの境界は、この層で定義します。
    - **DTO (Data Transfer Object):** `interface` 層とのデータのやり取りに使います。ドメインオブジェクトを直接外部に公開しません。
- **ルール:**
    - `domain` 層にのみ依存できます。
    - `interface` 層や `infrastructure` 層の具体的な実装を知ってはいけません。

### `interface` 層 (アダプター層)

- **役割:** 外部の世界（ユーザー、Webブラウザ、CLIなど）との入出力を担当するアダプター。
- **責務:**
    - **入力の受付:** HTTPリクエスト、コマンドライン引数などを受け取ります。（例: `Controller`）
    - **ユースケースの呼び出し:** 受け取った入力を `usecase` 層が理解できる形式（DTOなど）に変換し、適切なユースケースを呼び出します。
    - **出力の整形:** `usecase` 層から返された結果を、外部向けの形式（JSON, HTMLなど）に変換して返します。（例: `Presenter`, `View`）
- **ルール:**
    - `usecase` 層にのみ依存できます。
    - ビジネスロジックやデータアクセスロジックを**含んではいけません**。あくまで「通訳者」に徹します。

### `infrastructure` 層

- **役割:** すべての外部技術との連携を担当する層。データベース、外部API、フレームワークなどが含まれます。
- **責務:**
    - **リポジトリの実装:** `domain` 層で定義されたリポジトリのインターフェースを、具体的な技術（JPA, JDBCなど）を使って実装します。
    - **外部サービス連携:** 外部APIのクライアントなどを実装します。
    - **フレームワーク固有の設定:** DI（依存性注入）の設定や、各種フレームワークの設定ファイルを配置します。
- **ルール:**
    - `domain` 層のインターフェースを実装（implements）する形で依存します。
    - アプリケーションのコアロジック（`domain`, `usecase`）は、この層の変更による影響を受けないように設計します。

## 3. 機能追加のフロー

新しい機能を追加する際は、以下の順序で実装を進めることを推奨します。

1.  **`domain` 層:** まず、機能の核となるエンティティ、値オブジェクト、リポジトリI/Fを定義する。
2.  **`usecase` 層:** 次に、そのドメインオブジェクトを使って何を実現したいのか、ユースケースを実装する。
3.  **`interface` 層 / `infrastructure` 層:** 最後に、そのユースケースをどうやって外部に公開するのか（`interface`）、どうやってデータを永続化するのか（`infrastructure`）を実装する。
